
<!-- baseado em Pong -->
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>HTML5 - Canvas API</title>
        <style type="text/css">      
        		body {
        			background-color:black;
        		}           
                canvas {      
                	border-top: 30px solid #696969;          
                  	border-right: 50px solid #696969;
                  	border-left: 50px solid #696969;      
                  	background: black;                   	                            															
                }                
        </style>
    </head>
    
    <body onload="init()">	        
       	<canvas id="canvas" width="600" height="480">
       		Navegador não compatível com HTML5 Canvas
       	</canvas>  
       	
        
        <audio preload id="toque">
  			<source src="beep.mp3" type="audio/mpeg">
		</audio>
		
		<audio preload id="morte">
  			<source src="blackstar.mp3" type="audio/mpeg">
		</audio>
        
        
        <script>
            // Variáveis globais utilizadas no jogo
            var canvas, context, barraWidth, barraHeight, jogadorPosX, jogadorPosY, teclaEsquerdaPressionada, teclaDireitaPressionada, oponentePosX, 
                   oponentePosY, oponenteParaCima, bolaRaio, bolaPosX, bolaPosY, bolaParaDireita, bolaAngulo, bolaTempo,
                   velocidadeJogador, velocidadeOponente, velocidadeBola, pontosJogador, pontosOponente, totalWidth, totalHeigh, 
				   bricksPerRow, bricksHeight, bricksWidth, bolaDeltaX, bolaDeltaY;

			var bricks = [[1,1,1,1,1,1,1,1],[2,2,2,2,2,2,2,2],[3,3,3,3,3,3,3,3],[4,4,4,4,4,4,4,4],[5,5,5,5,5,5,5,5],[6,6,6,6,6,6,6,6]];			
            
            // Método para iniciar o jogo, executado no onload da tag body
            function init() {
            	canvas = document.getElementById("canvas");// procura o canvas
				context = canvas.getContext("2d");// recupera o contexto 2d

				barraWidth = 90;
				barraHeight = 10;
				jogadorPosX = (canvas.width / 2) - (barraWidth / 2);
				jogadorPosY = canvas.height - barraHeight;
				teclaEsquerdaPressionada = false;
				teclaDireitaPressionada = false;
				oponentePosX = 0;
				oponentePosY = barraHeight * 3;
				oponenteParaCima = false;
				bolaRaio = 10;
				bolaPosX = canvas.width / 2;
				bolaPosY = canvas.height / 2;
				bolaParaDireita = false;
				bolaAngulo = Math.floor(Math.random() * 21) - 10;
				bolaTempo = 0;
				velocidadeJogador = 10;
				velocidadeOponente = 10;
				velocidadeBola = 5;
				pontosJogador = 0;
				pontosOponente = 0;
				tetoPosX = 0;
				tetoPosY = 0;
				tetoHeight = 70;
				totalWidth = canvas.width;
				totalHeight = canvas.height;
				auxBrick = tetoHeight;
				bolaDeltaX = - 2;
				bolaDeltaY=  4;
				
				
				bricksPerRow = 8;                               
	            bricksHeight = 20;
	            bricksWidth = canvas.width/bricksPerRow;
				                
	            document.addEventListener('keyup', keyUp, false);// adiciona evento para keyup
                document.addEventListener('keydown', keyDown, false);// adiciona evento para keydown
                setInterval(gameLoop, 30);// chama a function gameLoop a cada 30 frames
			}

        	function keyDown(e) {
                if (e.keyCode == 37) { // up
                        teclaEsquerdaPressionada = true;
                }
                else if (e.keyCode == 39) { // down
        			teclaDireitaPressionada = true;
                }
        	}
        
			function keyUp(e) {
    			if (e.keyCode == 37) { // up
            		teclaEsquerdaPressionada = false; // jogador soltou tecla cima
    			}
    			else if (e.keyCode == 39) { // down
            		teclaDireitaPressionada = false; // jogador soltou tecla baixo
    			}
			}
                        
                         
            function gameLoop() {         
	            // Desenha tudo na tela
	            context.clearRect(0, 0, canvas.width, canvas.height);// limpa a tela antes de desenhar
	           
	            fillBrick();
	            player();
	            ball();
	            scoreBoard();
				moverJogador();
				moverBola();
			}
			
			function moverJogador(){
				
				if (teclaDireitaPressionada!=teclaEsquerdaPressionada) { // se o jogador estiver pressionando a tecla baixo ou cima
					if (teclaEsquerdaPressionada) { // se for para cima...
						if (jogadorPosX > 0) { // se n?o sair da tela...
							jogadorPosX -= velocidadeJogador;// muda a posi??o
						}
					}
					else { // se for para baixo...
						if (jogadorPosX < (canvas.width - barraWidth)) {// se n?o sair da tela...
							jogadorPosX += velocidadeJogador;// muda a posi??o
						}
					}
				}
			}

			function moverBola(){
			
				if(bolaPosY + bolaDeltaY - bolaRaio < 0 || colisaoYComTijolo()){
					bolaDeltaY = -bolaDeltaY;
					document.getElementById('toque').play();
				}
				
				
				if(bolaPosY+bolaDeltaY+bolaRaio > canvas.height+barraHeight)
				{
					endGame();
				}
				
				if((bolaPosX + bolaDeltaX - bolaRaio < 0) || (bolaPosX + bolaDeltaX + bolaRaio > canvas.width) || (colisaoXComTijolo())){
					bolaDeltaX = -bolaDeltaX;
					//bolaDeltaY = bolaDeltaY;
					document.getElementById('toque').play();
				}
				
				if(bolaPosY + bolaDeltaY + bolaRaio > jogadorPosY){
					if(bolaPosX + bolaDeltaX >= jogadorPosX && bolaPosX + bolaDeltaX < jogadorPosX + barraWidth){
						bolaDeltaY = - bolaDeltaY;
						document.getElementById('toque').play();
					}
				}
				
				bolaPosX = bolaPosX + bolaDeltaX;
				bolaPosY = bolaPosY + bolaDeltaY;
			
            }                          
			
			
			// Tijolos
			function fillBrick(){
				for (var i=0; i < bricks.length; i++) {
	                for (var j=0; j < bricks[i].length; j++) {
	                    drawBrick(j,i,bricks[i][j]);
	                }
	            }
			}			
			
			// Desenha um tijolo
			function drawBrick(x,y,type){  
			    switch(type){
			        case 1:
			            context.fillStyle = '#A52A2A';
			            break;
			        case 2:
			            context.fillStyle = '#D2691E';                    
			            break;
			        case 3:
			            context.fillStyle = '#556B2F';
			            break;
			        case 4:
			            context.fillStyle = '#228B22';
			            break;
			        case 5:
			            context.fillStyle = '#7CFC00';
			            break;
			        case 6:
			            context.fillStyle = '#0000FF';
			            break;			                                         
			        default:
			            context.clearRect(x*bricksWidth,y*bricksHeight,bricksWidth,bricksHeight);
			            break;
			 
			    }
			    if (type){			        
			        context.fillRect(x*bricksWidth,y*bricksHeight + 3*bricksHeight, bricksWidth,bricksHeight);				                
			    } 
			    
			}   

			// Jogador
			function player(){				
	            context.fillStyle = "#D2691E";
	            context.fillRect(jogadorPosX, jogadorPosY, barraWidth, barraHeight);//desenha jogador
			}

			// Bola
			function ball(){				
	            context.beginPath();// inicia o modo de desenho
	            context.arc(bolaPosX, bolaPosY, bolaRaio, 0, Math.PI * 2, true); // desenha o círculo desejado com as coordenadas no centro.
	            context.closePath();// finaliza o caminho (opcional)
	            context.fillStyle = "red";
	            context.fill();
			}

			// Placar
			function scoreBoard(){	            
	            var pontosA = pontosJogador;// variável temporária para não alterar pontosJogador
	            var pontosB = pontosOponente;// variável temporária para não alterar pontosOponente
	            
	            if (pontosA < 10) {// se o número de pontos for menor que 10, colocamos o zero á esquerda
	                pontosA = "0" + pontosA;
	            }
	            
	            if (pontosB < 10) {// se o número de pontos for menor que 10, colocamos o zero á esquerda
	                pontosB = "0" + pontosB;
	            }
	            
	            context.font = "42pt Helvetica";// tamanho e fonte para desenhar o texto
	            context.fillStyle = "#F00000";// cor preta (opcional)
	            context.fillText(pontosA + " " + pontosB, (canvas.width / 2) - 70, 50); // escreve texto na tela na posição desejada
			}
			
			//colisões
			function apagarTijolo(i,j) {
				bricks[i][j] = 0;
				pontosJogador += 1;
				document.getElementById('toque').play();
			}
			
			
			function colisaoXComTijolo(){
				var tocouX = false;
				for(var i = 0; i < bricks.length; i++){
					for(var j = 0; j < bricks[i].length; j++){
						if(bricks[i][j]){
						//console.log("brick i = "+i+" j = "+j);
							var tijoloX = j * bricksWidth;
							var tijoloY = i * bricksHeight;
							if(
									((bolaPosX+bolaDeltaX+bolaRaio >= tijoloX)&&(bolaPosX+bolaRaio <= tijoloX))//Tocando a esquesda
									||
									((bolaPosX + bolaDeltaX - bolaRaio <= tijoloX+bricksWidth)&&(bolaDeltaX - bolaRaio >= tijoloX + bricksWidth))//tocando a direita
									){
								if((bolaPosX+bolaDeltaY - bolaRaio <= tijoloY + bricksHeight)&&
										(bolaPosY+bolaDeltaX+bolaRaio >= tijoloY)){
											apagarTijolo(i, j);
											tocouX = true;
										}
							}
						}
					}
				}
				return tocouX;
			}
			
			function colisaoYComTijolo(){
				var tocouY = false;
				for(var i = 0; i < bricks.length; i++){
					for(var j = 0; j < bricks[i].length; j++){
						if(bricks[i][j]){
							//console.log("brick i = "+i+" j = "+j);
							//console.log("bricksWidth = "+bricksWidth);
							//console.log("bricksHeight = "+bricksHeight);
							var tijoloX = j * bricksWidth;
							//console.log("tijoloX ="+tijoloX);
							var tijoloY = i * bricksHeight;
							//console.log("tijoloy ="+tijoloY);
							if(
									((bolaPosY + bolaDeltaY - bolaRaio <= tijoloY + bricksHeight)&&
											(bolaPosY - bolaRaio >= tijoloY + bricksHeight))
									||
									((bolaPosY + bolaDeltaY + bolaRaio >= tijoloY)&&
											(bolaPosY + bolaRaio <= tijoloY))){
								
								if(bolaPosX + bolaDeltaX + bolaRaio >= tijoloX &&
										bolaPosX + bolaDeltaX - bolaRaio <= tijoloX + bricksWidth){
									apagarTijolo(i, j);
									tocouY = true;
								}
							}
						}
					}
				}
				return tocouY;
			}
			
			function endGame(){
					clearInterval(gameLoop);
					bolaPosX = 0;
					bolaPosY = canvas.height + 100;
					context.fillText('The End!!!!',canvas.width/2,canvas.height/2);
				}
				

        </script>
    </body>
</html>
